<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ city.name }} - Detaylı Hava Durumu</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: "Poppins", sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #3a7bd5, #00d2ff); 
            color: white;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 25px;
            padding-bottom: 50px;
        }

        /* Geri Butonu */
        .back-btn {
            text-decoration: none;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            color: #fff;
            border-radius: 12px;
            display: inline-flex;
            align-items: center;
            transition: 0.3s ease;
            font-weight: 500;
            margin-bottom: 20px;
        }
        .back-btn:hover { background: rgba(255,255,255,0.3); transform: translateX(-3px); }

        /* Başlık */
        .header-section { margin-bottom: 20px; }
        .city-name { font-size: 42px; font-weight: 600; margin: 0; text-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .sub-title { opacity: 0.9; font-size: 16px; margin-top: 5px; }

        /* --- GRAFİK KUTUSU --- */
        .chart-wrapper {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(12px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
        }

        .chart-tabs {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            padding-bottom: 10px;
        }
        .tab-item {
            font-size: 15px;
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            padding-bottom: 5px;
            position: relative;
        }
        .tab-item.active {
            color: #fff;
            font-weight: 600;
        }
        .tab-item.active::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: #FFC107;
            border-radius: 2px;
        }

        .chart-container {
            height: 250px; 
            width: 100%;
        }

        /* --- GÜNLÜK KARTLAR --- */
        .day-section { margin-bottom: 30px; }
        .day-title {
            font-size: 20px; font-weight: 600; margin-bottom: 15px;
            border-left: 4px solid #fff; padding-left: 10px;
        }
        .forecast-scroll {
            display: flex; overflow-x: auto; gap: 15px; padding-bottom: 15px;
            scrollbar-width: thin; scrollbar-color: rgba(255,255,255,0.4) transparent;
        }
        .forecast-card {
            min-width: 120px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(5px);
            border-radius: 16px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s;
        }
        .forecast-card:hover { transform: translateY(-5px); background: rgba(255,255,255,0.25); }
        
        .time { font-size: 14px; opacity: 0.9; margin-bottom: 5px; }
        .icon img { width: 50px; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.1)); }
        .temp { font-size: 18px; font-weight: 600; margin: 5px 0; }
        
        .forecast-scroll::-webkit-scrollbar { height: 6px; }
        .forecast-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 10px; }
    </style>
</head>

<body>
    <div class="container">

        <a href="{% url 'index' %}" class="back-btn">
            <i class="fas fa-arrow-left" style="margin-right: 8px;"></i> Geri dön
        </a>

        <div class="header-section">
            <h1 class="city-name">{{ city.name }}</h1>
            <p class="sub-title">5 Günlük Tahmin</p>
        </div>

        <div class="chart-wrapper">
            <div class="chart-tabs">
                <span class="tab-item active">Sıcaklık</span>
                <span class="tab-item">Yağış</span>
                <span class="tab-item">Rüzgar</span>
            </div>
            
            <div class="chart-container">
                <canvas id="tempChart"></canvas>
            </div>
        </div>

        {% for day in daily_forecasts %}
        <div class="day-section">
            {% with day_date=day.date %}
                {% now "Y-m-d" as today %}
                <div class="day-title">
                    {% if day_date == today %}Bugün{% else %}{{ day.date_obj|date:"l" }}{% endif %}
                    <span style="font-size: 15px; opacity: 0.7; font-weight: normal; margin-left: 8px;">
                        {{ day.date_obj|date:"d F" }}
                    </span>
                </div>
            {% endwith %}

            <div class="forecast-scroll">
                {% for item in day.items %}
                <div class="forecast-card">
                    <div class="time">{{ item.dt_txt|slice:"11:16" }}</div>
                    <div class="icon"><img src="http://openweathermap.org/img/wn/{{ item.weather.0.icon }}@2x.png"></div>
                    <div class="temp">{{ item.main.temp|floatformat:0 }}°C</div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}

    </div>

    <script>
        const labels = [];
        const temps = [];

        {% for day in daily_forecasts %}
            {% for item in day.items %}
                labels.push("{{ item.dt_txt|slice:'8:10' }}/{{ item.dt_txt|slice:'5:7' }} {{ item.dt_txt|slice:'11:16' }}");
                temps.push({{ item.main.temp|floatformat:0 }});
            {% endfor %}
        {% endfor %}

        const ctx = document.getElementById('tempChart').getContext('2d');
        
        let gradient = ctx.createLinearGradient(0, 0, 0, 300);
        gradient.addColorStop(0, 'rgba(255, 235, 59, 0.5)');
        gradient.addColorStop(1, 'rgba(255, 235, 59, 0.0)');

        const tempChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Sıcaklık',
                    data: temps,
                    borderColor: '#FFEB3B',
                    backgroundColor: gradient,
                    borderWidth: 3,
                    pointBackgroundColor: '#fff',
                    pointRadius: 0,
                    pointHoverRadius: 6,
                    pointHitRadius: 20,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                layout: {
                    padding: { top: 10, left: 10, right: 10, bottom: 0 }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        enabled: true,
                        backgroundColor: 'rgba(255, 255, 255, 0.9)',
                        titleColor: '#333',
                        bodyColor: '#333',
                        titleFont: { size: 13 },
                        bodyFont: { size: 14, weight: 'bold' },
                        padding: 10,
                        cornerRadius: 8,
                        displayColors: false,
                        callbacks: {
                            label: function(context) {
                                return context.parsed.y + ' °C';
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: { display: false, drawBorder: false },
                        ticks: { 
                            color: 'rgba(255,255,255,0.7)', 
                            maxTicksLimit: 6,
                            font: { size: 11 }
                        } 
                    },
                    y: {
                        display: true, // SOL EKSENİ GÖSTER
                        position: 'left', // Sol tarafta
                        min: Math.min(...temps) - 5,
                        grid: {
                            color: 'rgba(255,255,255,0.1)', // Hafif ızgara çizgileri
                            drawBorder: false
                        },
                        ticks: {
                            color: 'rgba(255,255,255,0.9)', // Sayı rengi
                            font: { size: 12 },
                            stepSize: 5 // 5'er 5'er artsın
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>