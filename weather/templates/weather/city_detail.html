{% load static %}
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ city.name }} - Detaylı Hava Durumu</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="stylesheet" href="{% static 'css/detail.css' %}">
</head>

<body>
    <div class="container">

        <a href="{% url 'index' %}" class="back-btn">
            <i class="fas fa-arrow-left" style="margin-right: 8px;"></i> Geri dön
        </a>

        <div class="header-section">
            <h1 class="city-name">{{ city.name }}</h1>
            <p class="sub-title">5 Günlük Tahmin</p>
        </div>

        <div class="chart-wrapper">
            <div class="chart-tabs">
                <span class="tab-item active">Sıcaklık</span>
                <span class="tab-item">Yağış</span>
                <span class="tab-item">Rüzgar</span>
            </div>
            
            <div class="chart-container">
                <canvas id="tempChart"></canvas>
            </div>
        </div>

        {% for day in daily_forecasts %}
        <div class="day-section">
            {% with day_date=day.date %}
                {% now "Y-m-d" as today %}
                <div class="day-title">
                    {% if day_date == today %}Bugün{% else %}{{ day.date_obj|date:"l" }}{% endif %}
                    <span style="font-size: 15px; opacity: 0.7; font-weight: normal; margin-left: 8px;">
                        {{ day.date_obj|date:"d F" }}
                    </span>
                </div>
            {% endwith %}

            <div class="forecast-scroll">
                {% for item in day.items %}
                <div class="forecast-card">
                    <div class="time">{{ item.dt_txt|slice:"11:16" }}</div>
                    <div class="icon"><img src="http://openweathermap.org/img/wn/{{ item.weather.0.icon }}@2x.png" alt="icon"></div>
                    <div class="temp">{{ item.main.temp|floatformat:0 }}°C</div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}

    </div>

    <script src="{% static 'js/chart_logic.js' %}"></script>

    <script>
        const labels = [];
        const temps = [];

        {% for day in daily_forecasts %}
            {% for item in day.items %}
                labels.push("{{ item.dt_txt|slice:'8:10' }}/{{ item.dt_txt|slice:'5:7' }} {{ item.dt_txt|slice:'11:16' }}");
                temps.push({{ item.main.temp|floatformat:0 }});
            {% endfor %}
        {% endfor %}

        if (typeof initChart === 'function') {
            initChart(labels, temps);
        } else {
            console.error("initChart fonksiyonu bulunamadı! chart_logic.js dosyasını kontrol edin.");
        }
    </script>
</body>
</html>